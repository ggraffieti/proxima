% !TeX spellcheck = it_IT
\documentclass[a4paper,12pt]{report}

\usepackage{alltt, fancyvrb, url}
\usepackage{graphicx}
\usepackage{algorithmic}
\usepackage[utf8]{inputenc}
\usepackage{titling}
\usepackage{fancyhdr}
\usepackage{fontenc}
\usepackage{amsmath,mathtools,algorithm}
\usepackage{amssymb}
\usepackage{longtable}
\usepackage{setspace}
\usepackage{listings}
\usepackage{color}
\usepackage{eurosym}


\usepackage[italian,hidelinks]{hyperref}

\usepackage[italian]{babel}
\usepackage[italian]{cleveref}

\lstdefinestyle{json}
{
	basicstyle = \footnotesize\ttfamily,
	frame = single,
	tabsize = 4
}

\lstdefinelanguage{myScala}{
	morekeywords={abstract,case,catch,class,def,%
		do,else,extends,false,final,finally,%
		for,if,implicit,import,match,mixin,%
		new,null,object,override,package,%
		private,protected,requires,return,sealed,%
		super,this,throw,trait,true,try,%
		type,val,var,while,with,yield},
	basicstyle=\ttfamily\small,
	sensitive=true,
	keywordstyle=\color{blue},
	morecomment=[l]{//},
	morecomment=[n]{/*}{*/},
	morestring=[b]",
	morestring=[b]',
	morestring=[b]"""
}


% MARGINI LARGHI
%\textwidth 6.3 in % Width of text line.
%    \textheight 9.2 in
%    \oddsidemargin 0 in      %   Left margin on odd-numbered pages.
%    \evensidemargin 0 in      %   Left margin on even-numbered pages.
%    \topmargin 0.2 in
%    \headheight 0 in       %   Width of marginal notes.
%    \headsep 0 in
%    \topskip 0 in

\pretitle{%
	\begin{center}
		\LARGE
	}
\posttitle{\end{center}}


\title{\Huge \textbf{Proxima} \\
	\vspace{10pt}
	\vspace{20pt}
}
\author{
	Gabriele Graffieti \\ \small \url{gabriele.graffieti@studio.unibo.it}
	\vspace{15pt}
	\\
	Alfredo Maffi \\ \small \url{alfredo.maffi@studio.unibo.it}
	\vspace{15pt}
	\\
	Manuel Peruzzi \\ \small \url{manuel.peruzzi@studio.unibo.it}
}

\date{}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\ifthenelse{\isodd{\value{page}}}{\thepage}{\leftmark}}
\fancyhead[R]{\ifthenelse{\isodd{\value{page}}}{\leftmark}{\thepage}}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}} 

\begin{document}

\maketitle
\pagenumbering{arabic}


\tableofcontents

\chapter{Introduzione}

\chapter{Idea}
\section{Visione} \label{vision}
Negli ultimi anni si è assistito ad una sempre maggiore distribuzione di dispositivi di calcolo, inseriti anche nei più comuni oggetti di uso quotidiano. Ciò ha portato ad una distribuzione della computazione, che non è soltanto ad appannaggio dei dispositivi computazionali classici, ma ripartita in quasi ogni oggetto reale. 

Una delle sfide nel futuro della \emph{computer science} sarà quella di gestire l'interazione tra tutti questi oggetti, che dovranno interagire sia tra loro, che con gli esseri umani. Dato il numero sempre crescente di dispositivi, e la tipica bassa potenza computazionale di cui sono dotati, non è pensabile che l'interazione sia esplicita e avvenga nel mondo fisico. La nostra vision è quella di creare uno strato virtuale sopra alla realtà fisica, dove ogni dispositivo viene mappato in un'entità virtuale. Dato che l'interazione tra due oggetti acquista senso solamente se essi sono vicini tra loro nel mondo reale, i dispositivi fisici hanno il solo scopo di cercare altri dispositivi vicini nello spazio, per poi interagire con loro nello strato virtuale, rappresentato dal nostro sistema. 

Ogni componente del sistema, sia esso un dispositivo computazionale o una persona, avrà associato ad esso un identificativo, che agirà come \emph{entry point} per il sistema virtuale. I componenti, quindi, potranno ricercare altri componenti vicini nel mondo reale, ed attraverso l'identificativo poter interagire con loro nel mondo virtuale. In particolare l'interazione sarà automatica, e non richiederà alcuna azione esplicita. Sarà compito della controparte virtuale degli oggetti decidere se e come interagire, quali informazioni scambiare e con chi scambiarle.

Attraverso il deployment del sistema proposto saranno aperti vari nuovi scenari, tra cui
\begin{itemize}
	\item  Stravolgimento dell'interazione uomo-macchina, che non sarà più guidata da espliciti comandi, ma totalmente trasparente all'utente. Ad esempio, una casa intelligente può rilevare la presenza del proprietario nelle vicinanze, ed interagendo con il suo avatar virtuale può ricevere i dati di come il proprietario vuole interagire con essa (accensione luci in alcune stanze, accensione riscaldamento, apertura porte o finestre\dots) senza che il proprietario debba fisicamente fare alcuna azione
	\item Totale personalizzazione dell'interazione tra persona e dispositivo computazionale, che potrà essere imparata dal sistema in automatico tramite metodi di \emph{learning}.
	\item Metodi di pagamento automatico, senza l'obbligo del possesso di carte o moneta. Il dispositivo di pagamento rileverà in automatico le merci ed il compratore, e comunicando con i rispettivi avatar virtuali procederà al pagamento della merce. L'avatar del compratore potrà richiedere la conferma della persona reale prima di procedere. Sui mezzi pubblici non sarà più necessario l'acquisto del biglietto, ma semplicemente il mezzo, interagendo con gli avatar dei passeggeri, addebiterà il prezzo del bigliett all'ingresso nel mezzo.
	\item Scambio di dati tra persone fisiche, ad esempio dati medici o giudiziari. L'avatar di un medico contatterà l'avatar del paziente, che fornirà ad esso i dati medici, mostrati poi al medico nel mondo reale. In maniera simile un agente di polizia potrà ricevere i dati giudiziari di persone sospette, ad esempio per controlli negli aeroporti. 
	\item Scambio di dati tra dispositivi computazionali, ad esempio nel caso di un ricovero in terapia intensiva, l'avatar virtuale del ricovero (ad esempio legato fisicamente al letto) potrà aggregare tutti i dati rilevati dai sensori vicini (ossigenazione del sangue, elettrocardiogramma, temperatura\dots) per condividerli con i medici o eseguire \emph{learning} sugli stessi, in modo da rilevare ed anticipare peggioramenti o miglioramenti del paziente.
\end{itemize}

\section{Goal} \label{goal}
L'obiettivo di questo elaborato è la progettazione e l'implementazione del primo scheletro del sistema, in modo da creare l'infrastruttura generale, che sarà poi estesa in modo da implementare le funzionalità descritte in \autoref{vision}. Oltre a produrre la base del sistema ci si concentrerà su un caso concreto, in modo da mostrare fin da subito l'utilità dell'idea proposta. 

Una delle maggiori problematiche nell'ambito del primo soccorso, è quella di riconoscere velocemente il paziente, e accedere quindi rapidamente ai suoi dati medici, quali allergie o farmaci assunti abitualmente. La conoscenza di tali dati da parte del medico di primo soccorso è vitale per operare in modo sicuro, ed evitare di peggiorare la situazione clinica del paziente. Spesso non è possibile avere un veloce accesso a tali dati, dato che il paziente può essere privo di conoscenza, in stato di shock o incapace di comunicare. Inoltre la consultazione delle informazioni avviene solamente una volta arrivati in ospedale: esse non sono quindi disponibili durante il primo soccorso ed il trasporto.

L'obiettivo di questo elaborato è quello di risolvere il problema attraverso il sistema \emph{Proxima}: il medico rileverà la presenza di un paziente nelle vicinanze, interagirà virtualmente con lui e riceverà i dati medici nel mondo fisico, senza alcun bisogno di interazione diretta, spesso impossibile. Verrà, perciò, prima implementata la parte generale del sistema, e poi mostrata la sua potenzialità in un caso reale, come quello descritto.  

\chapter{Analisi dei requisiti} \label{requirements}
\section{Idea}
Il sistema \emph{Proxima} nasce dalla necessità di fornire un supporto, in caso di emergenza, ai soccorritori accorsi sul posto. Ogni persona dovrà essere munita di un dispositivo di identificazione, che potrà essere letto dal soccorritore, tramite l'utilizzo di un apposito lettore. Tale lettore dovrà essere provvisto di schermo, sul quale saranno visualizzati i dati medici del paziente, in modo da consentire interventi mirati e con maggiore sicurezza. 

\section{Requisiti funzionali}
\begin{description}
	\item \textbf{Identificatore}: ogni utilizzatore del servizio dovrà essere costantemente in possesso di tale dispositivo, che dovrà quindi essere compatto, non ingombrante e possibilmente indossabile. Inoltre, la sua durata media di funzionamento non dovrà essere inferiore a 3 anni. Esso sarà caratterizzato dalle seguenti funzionalità: 
	\begin{itemize}
		\item Identificare l'utente in maniera univoca.
		\item La trasmissione dell'identificativo dovrà avvenire in modalità \emph{wireless}, con un raggio limitato (inferiore a 3 metri).
		\item Lo scambio dell'identificativo dovrà avvenire in maniera trasparente all'utente, senza consensi espliciti ad ogni trasmissione.
	\end{itemize}

	\item \textbf{Lettore}: dispositivo che dovrà essere in possesso del soccorritore, in modo che possa identificare e mostrare i dati degli utenti. Per fare ciò dovrà essere in grado di comunicare sia con gli identificatori, sia con la banca dati. Il dispositivo dovrà avere le seguenti funzionalità:
	\begin{itemize}
		\item Permettere la ricerca degli identificatori nelle vicinanze (inferiore a 3 metri). La ricerca dovrà essere esplicitamente avviata dal soccorritore, e dovrà essere possibile interromperla.
		\item Nel caso durante la fase di ricerca siano stati trovati degli identificatori, il lettore dovrà essere in grado di recuperare l'identificativo dei relativi possessori.
		\item Contattare la banca dati remota in modo da acquisire i dati medici relativi al paziente identificato dall'identificativo recuperato in precedenza.
		\item Attraverso il lettore dovrà essere possibile identificare in maniera univoca il soccorritore, in modo che il sistema possa decidere se il soccorritore sia autorizzato alla lettura delle informazioni mediche dell'utente.
		\item Mostrare le informazioni mediche del paziente al soccorritore.
	\end{itemize}
\end{description}

I dati medici degli utenti sono forniti sotto forma di banca dati elettronica, accessibile attraverso la rete internet. All'interno della banca dati fornita sono conservate anche le informazioni sui turni dei soccorritori. 

Il sistema dovrà definire una politica di accesso ai dati contenuti nella banca dati sulla base dell'identità dei soccorritori e dei turni di lavoro. 

\section{Glossario} \label{glossary}
In questa sezione verranno esplorati ed esplicati i concetti chiave usati dal committente durante la fase di raccolta dei requisiti. 
\begin{itemize}
	\item \textbf{Soccorritore}: medico o infermiere che presta soccorso ai pazienti sia in ospedale, che anche all'esterno in caso di emergenze. Nella definizione di soccorritore data dal committente, non è incluso il personale che non è adibito ad un intervento invasivo diretto sul paziente (personale volontario e non senza abilitazioni mediche/infermieristiche). Ad esempio, a bordo di un'ambulanza atta a svolgere una funzione di trasporto e di primo soccorso, è consuetudine la presenza di personale (volontario e non), la cui mansione è limitata ad una prima stabilizzazione del paziente, oltre al trasporto dello stesso presso un centro ospedaliero. Tale personale non è considerato in questa categoria.
	\item \textbf{Paziente}: Persona che necessita di cure mediche in una situazione di emergenza. Sono inclusi in questa categoria sia i soggetti che si recano in ospedale in autonomia, sia i soggetti che giungono in ospedale scortati da appositi mezzi di trasporto (come ambulanze).
	\item \textbf{Situazione di emergenza}: Circostanza o condizione di immediato pericolo per la salute del paziente, che necessita di un perentorio intervento di uno o più soccorritori (ad esempio traumi dovuti ad incidenti automobilistici, condizioni acute quali infarto, ictus, \dots).
	\item \textbf{Identificativo}: codice che permette di risalire all'identità di un certo utente all'interno del sistema. Esso deve contenere la minima quantità di informazione che consente di identificare un paziente che è in possesso di un identificatore
	\item \textbf{Lettore}: dispositivo Android (smartphone, tablet), in grado di recuperare l'identificativo del paziente dall'identificatore e dotato di una costante connessione di rete, in modo da poter comunicare con la base di dati remota fornita dal committente. Su richiesta, le funzionalità del lettore devono essere condensate all'interno di un'applicazione nativa Android.
	\item \textbf{Dati medici}: dati relativi al paziente che risultano particolarmente utili al soccorritore nella fase di primo soccorso. Tali informazioni sono contenute all'interno della banca dati fornita dal committente. Nello specifico, esse sono relative a:
	\begin{itemize}
		\item Breve anagrafica del paziente (nome, cognome, codice fiscale, data di nascita).
		\item Gruppo sanguigno.
		\item Consenso o meno alla donazione di organi.
		\item Malattie (ad esempio sclerosi multipla, fibrosi cistica, \dots).
		\item Allergie ai medicinali, ai cibi (come arachidi, latte, \dots), alle punture di insetti, ai materiali e ad altre svariate sostanze.
		\item Medicinali abitualmente assunti dal paziente.
	\end{itemize}
	Un sottoinsieme dei dati sopra elencati è soggetto a variazioni nel tempo (ad esempio i medicinali assunti), la banca dati conterrà sempre la versione attuale delle informazioni, e verrà quindi aggiornata periodicamente.  
	\item \textbf{Turno del soccorritore}: fasce orarie nelle quali il soccorritore presta il suo servizio in ospedale o nei mezzi adibiti al primo soccorso e al trasporto dei pazienti. Il turno di un soccorritore è soggetto a variazioni nel tempo, comportando un conseguente aggiornamento della banca dati.
\end{itemize}

\section{Scenari}
È possibile individuare due scenari di interesse, a seconda del luogo in cui il servizio viene utilizzato.
\subsection{Scenario 1} \label{scenario1}
In una situazione di emergenza, il soccorritore arriva sul posto, apre l'applicazione sul proprio lettore e si autentica nel sistema. 

\subsubsection*{Scenario 1.1}
Inizia la ricerca degli identificatori nelle vicinanze. Se uno o più identificatori sono rilevati, viene recuperato l'identificativo di quello che risulta essere più vicino. I dati medici del paziente sono poi mostrati sullo schermo del dispositivo, in modo da fornire un supporto per il soccorritore.

\subsubsection*{Scenario 1.2}
Inizia la ricerca degli identificatori nelle vicinanze. Se uno o più identificatori sono rilevati, viene recuperato l'identificativo di quello che risulta essere più vicino. Nel caso in cui il soccorritore non sia autorizzato alla lettura dei dati (in quanto non qualificato o non in un turno lavorativo), l'accesso ai dati è negato e viene mostrato un messaggio che avvisa il soccorritore di intervenire ``manualmente'', senza contare sul servizio.
\subsubsection*{Scenario 1.3} 
Non è possibile contattare la banca dati, viene mostrato un messaggio che avvisa il soccorritore di intervenire ``manualmente'', senza poter contare sul servizio.
\subsubsection*{Scenario 1.4}
Il paziente non è in possesso di un identificatore, il medico deve intervenire  ``manualmente'', senza poter contare sul servizio.

\subsection{Scenario 2}
Il paziente giunge in ospedale per richiedere assistenza medica, in una situazione di emergenza. Il soccorritore (medico o infermiere di turno in ospedale) apre l'applicazione sul proprio lettore e si autentica nel sistema. 

I possibili sotto-scenari che si possono manifestare corrispondono a quelli descritti in sezione \ref{scenario1}. In questo caso, però, il luogo nel quale avviene il soccorso è un reparto di una struttura ospedaliera attrezzata, nella quale è garantita la presenza dei soli soccorritori autorizzati e una costante connettività. 

Se il paziente è in possesso di un identificatore, esso viene rilevato nella fase di ricerca del lettore e i dati medici del paziente sono mostrati sullo schermo del lettore, in modo da fornire un supporto per il soccorritore. Altrimenti il medico deve intervenire "manualmente" senza poter contare sul servizio.

\section{Requisiti non funzionali}
Il sistema dovrà essere progettato e sviluppato in modo da fornire un servizio a livello nazionale (Italia). 
Di seguito sono elencati i requisiti non funzionali del sistema:
\begin{itemize}
	\item \textbf{Costi}: il costo dell'identificatore non dovrà superare i 5 euro per unità. I dispositivi \emph{Android} utilizzati come lettori dovranno essere acquistati, ed il loro prezzo non dovrà superare i 200 euro per unità.
	\item \textbf{Sicurezza e privacy}: tutte le comunicazioni tra i componenti del sistema dovranno essere sicure, e non sarà possibile l'intercettazione dei dati da parte di soggetti non autorizzati. I dati medici dei pazienti sono dati sensibili, ed il loro accesso dovrà essere garantito solamente ai soccorritori, e solamente in reali situazioni di emergenza. I dati dovranno essere conservati e trasmessi in modo sicuro, in modo da garantire la loro integrità. Per questioni legali ogni accesso ai dati dovrà essere opportunamente memorizzato, in modo che sia sempre possibile risalire a quale soccorritore ha letto i dati del dato paziente. Non dovrà essere possibile che un paziente sia scambiato con un altro, o che volontariamente assuma l'identità di un'altra persona.
	\item \textbf{Availability}: il servizio offerto dovrà essere sempre consultabile, e dovrà fornire i dati medici corretti ad ogni interazione con i soccorritori autorizzati. Il sistema dovrà essere raggiungibile da qualunque luogo, a patto che sia possibile stabilire una connessione internet. Il ritardo di risposta del sistema (assumendo tempo zero per la trasmissione dei dati) non dovrà mai superare i 2 secondi.
	\item \textbf{Scalability}: il sistema avrà per lo più un carico di lavoro costante, ma dovrà gestire anche picchi di richieste, dovuti ad esempio a catastrofi naturali, attacchi terroristici ecc\dots Il tempo di risposta massimo dovrà essere sempre mantenuto al di sotto del valore espresso precedentemente, indipendentemente dal numero di richieste che il sistema dovrà gestire. 
	\item \textbf{Fault tolerance}: nel caso non sia possibile stabilire una connessione con il sistema dovrà essere mostrato un avviso al soccorritore di modo che intervenga sul paziente senza fare affidamento sul sistema. In questo modo non viene perso tempo prezioso nella ricerca e nell'identificazione del paziente. I dati medici dovranno essere in ogni caso recuperabili, anche a seguito di fallimenti del sistema. Essi, infatti, non dovranno mai venire persi. 
	\item \textbf{User experience}: i dati medici dovranno essere mostrati al soccorritore in modo da facilitare la loro lettura e consultazione. Essi, infatti, dovranno essere letti in fasi particolarmente concitate, per cui la loro presentazione non dovrà far perdere tempo al soccorritore, oltre a quello necessario alla loro lettura. 
\end{itemize}

\section{Domain model} \label{domain-model}
\subsection{Banca dati}
Il committente ha reso disponibile una base dati, la quale contiene le informazioni mediche dei pazienti. I dati sono memorizzati all'interno della banca dati attraverso un database \emph{MongoDB}\footnote{\url{https://www.mongodb.com}}, e strutturati in documenti \emph{JSON}\footnote{\url{https://www.json.org}}. I dati sono contenuti in un'unica collezione chiamata \emph{medicalData}. La struttura dei dati è riportata di seguito:
\begin{lstlisting}[style=json, caption={Esempio di una entry all'interno del database dato.}, captionpos=b]
{
	"_id": ObjectId("507f1f77bcf86cd799439011"),
	"name": "John",
	"surname": "Doe",
	"CF": "DOEJHN70P16F205Y",
	"birthDate": "1970-09-16T00:00:00.000Z",
	"bloodGroup": "A+",
	"organDonor": "YES",
	"medicalConditions": [
		"Heart Disease",
		"Diabetes type 2",
		"Pacemaker"
	],
	"drugAllergies": [
		"Penicillan",
		"Morphine"
	],
	"otherAllergies": [
		"Peanuts",
		"Bee sting",
		"Latex",
		"Wheat"
	],
	"medications": [
		"Prozac",
		"Refludan",
		"Hydrochiorothiazide",
		"Cialis",
		"Plavix"
	]
}
\end{lstlisting}

Similmente la base dati contenente i turni dei soccorritori è fornita, e anch'essa consta di una collezione \emph{MongoDB}, chiamata \emph{RescuersWorkSchedule}. Il formato dei dati è riportato di seguito:

\begin{lstlisting}[style=json, caption={Esempio di un turno lavorativo all'interno della banca dati. Gli orari di inizio e fine turno sono espressi in numero di secondi dopo la mezzanotte del giorno stesso. In uno stesso giorno un soccorritore può avere assegnati più turni.}, captionpos=b]
{
	"rescuerID": "df54f5gdfh4",
	"monday": [
		{
			"begin": 0,
			"end": 21600
		},
		{
			"begin": 79200,
			"end": 86499
		}
	],
	"tuesday": [
		{
			"begin": 0,
			"end": 25200
		}
	],
	
	...
	
}
\end{lstlisting}

La banca dati è accessibile attraverso la rete Internet tramite una richiesta HTTP GET all'indirizzo 
\subsection{Modello}
La fase di raccolta dei requisiti ha permesso una comprensione delle richieste del committente, che sono state definite ed esplicate in forma testuale nelle sezioni precedenti. Una rappresentazione più efficacie dei requisiti può essere raggiunta attraverso la costruzione di un modello del dominio, in grado di catturare gli aspetti chiave del sistema. 

In questa fase, la costruzione di un modello del dominio ha un duplice scopo, in quanto permette:
\begin{itemize}
	\item Una definizione formale dei requisiti, che costituisce un input per la successive fasi di analisi e progettazione.
	\item Un confronto diretto con il committente, in modo da confermare o smentire la comprensione dei requisiti raccolti. 
\end{itemize}

La criticità principale di questo approccio consiste nella realizzazione di un modello comprensibile sia all'interno della \emph{software house}, sia al committente. La realizzazione di un modello eseguibile permette di evitare tale problematica, attraverso la costruzione di uno o più prototipi funzionanti in tempi brevi. Il prototipo consente di definire il comportamento generale del sistema e sarà sottoposto all'attenzione del committente. 

Il modello del dominio è stato definito tramite l'utilizzo del meta-modello \emph{QActor}, sviluppato dal professore Antonio Natali. \emph{QActor} è un linguaggio \emph{custom} che consente di esprimere in maniera concisa la struttura, l'interazione ed il comportamento di un sistema software eterogeneo e distribuito.

Sulla base dei requisiti, si procede in maniera incrementale alla realizzazione di due modelli:
\begin{itemize}
	\item \textbf{Base requirement}: si individuano nel sistema tre componenti principali, nello specifico patient, doctor e control (componente che gestisce l'accesso alla banca dati), modellati come entità attive (attori). I componenti sono considerati come delle \emph{black-boxes}, ponendo il focus sulla loro interazione. Dal modello emerge il comportamento del sistema, il cui scopo è quello di permettere al soccorritore di reperire i dati medici (in questo caso simulati) del paziente a lui più vicino.
	\item \textbf{Authorization requirement}: estensione del modello base attraverso l'introduzione di un vincolo che impedisce l'accesso ai dati ai soccorritori non autorizzati.
\end{itemize}
I modelli sopra illustrati sono eseguibili e costituiscono dei primi prototipi funzionanti del sistema. Questa caratteristica permette un confronto diretto con il committente, in modo da valutare la comprensione dei requisiti.

\section{Test plan}
I requisiti, raccolti ed analizzati in capitolo \ref{requirements}, devono guidare l'intero processo di progettazione e sviluppo del progetto. È necessario definire le modalità attraverso le quali dovrà avvenire la verifica dei requisiti, in modo da poter valutare in ogni fase del progetto la conformità del prodotto rispetto ai requisiti.

Si individuano due funzionalità principali del sistema che dovranno essere soggette al processo di testing.
\begin{description}
	\item \textbf{Correttezza dei dati}: un soccorritore, dopo aver avviato la ricerca di identificatori nelle vicinanze, deve ricevere esclusivamente i dati medici relativi al paziente più vicino. I dati ricevuti devono essere quelli contenuti all'interno della banca dati per il paziente specifico (come stabilito in sezione \ref{glossary}).
	\item \textbf{Gestione dell'accesso ai dati}: un soccorritore non autorizzato non deve poter ricevere alcun dato medico. Le informazioni che definiscono l'autorizzazione o meno di un certo soccorritore sono quelle contenute all'interno della banca dati (come stabilito in sezione \ref{glossary}). 
\end{description}

\chapter{Analisi del problema}
\section{Analisi del sistema generale}
Come anticipato nella \autoref{goal}, lo scopo del progetto non è soltanto quello di soddisfare i requisiti esposti nel \autoref{requirements}, ma di costruire la base di tutto il sistema, sopra la quale saranno implementati i servizi, tra i quali quello di gestione delle emergenze mediche esposto in precedenza. Il sistema \emph{Proxima} dovrà quindi fornire una base, sopra la quale potranno essere costruiti servizi e componenti. Esso agirà quindi da \emph{middleware}, e dovrà fornire ai servizi ed agli utenti le seguenti funzionalità:
\begin{itemize}
	\item Servizio di identificazione. Esso sarà la base del sistema, attraverso cui tutte le funzionalità potranno essere implementate. L'identificazione dovrà essere univoca, e offerta come servizio a chiunque voglia interagire con il sistema. Sarà ovviamente compito del sistema stesso gestire l'accesso ai dati, che dovrà essere garantito solo a chi autorizzato. I vari servizi non dovranno essere accessibili in modo diretto, ma solamente attraverso il sistema \emph{Proxima}.
	\item Dovrà essere possibile, in modo semplice, estendere il sistema con un nuovo servizio, senza che l'architettura generale del sistema debba essere ripensata. Ogni servizio sarà responsabile per i dati degli utenti inerenti ad esso, in modo che non esista una unica base dati centralizzata. I servizi dovranno essere implementati nel modo più semplice possibile, sfruttando ciò che il sistema generale mette a disposizione. La politica di accesso ai dati sarà gestita sia dal sistema generale sia dai servizi stessi. In pratica ogni servizio dovrà essere responsabile delle informazioni sugli utenti che contiene, ed in parte anche delle politiche di accesso ad esse.
	\item Ogni utente potrà, a sua discrezione, decidere quali dati rendere pubblici per la lettura. Notare che solamente chi autorizzato può, in ogni caso, leggere i dati. L'utente può decidere in qualsiasi momento la politica di gestione dei dati, ad esempio decidendo di non condividere mai i dati inerenti ai suoi acquisti in un dato supermercato. Alcune categorie di dati, come quelli medici o giudiziari, dovranno essere sempre consultabili, ovviamente da personale autorizzato (in questo caso medici e pubblici ufficiali).
	\item Il sistema generale dovrà implementare una comunicazione sicura con i lettori, in modo che nessun dato trasmesso possa essere intercettato o modificato. La sicurezza delle comunicazioni dovrà essere gestita in modo centrale, e non lasciata come compito ai singoli servizi. Inoltre anche la comunicazione tra servizi e sistema generale dovrà essere sicura ed al riparo da qualsiasi attacco. I protocolli di comunicazione tra tutti i componenti del sistema dovranno essere ben definiti, in modo che sia facile una sua estensione. 
	\item Il sistema dovrà essere sempre consultabile, e i tempi di risposta dovranno essere brevi, indipendentemente dal numero di richieste in corso nello stesso momento. Ciò significa che il sistema generale dovrà possedere i requisiti di \emph{availability} e \emph{scalability}.
	\item Il sistema dovrà essere resistente ad i guasti, in particolare quelli relativi a manomissioni dell'hardware, attacchi informatici al software o attacchi \emph{Denial of Service}. Esso dovrà garantire un livello di servizio accettabile anche in presenza di tali attacchi, e dovrà essere sempre possibile recuperare la piena funzionalità dello stesso, sia in caso di attacchi sia di catastrofi naturali. 
\end{itemize}
\section{Problematiche}\label{issues}
In questa sezione verranno esaminate le varie problematiche che scaturiscono da un'analisi del sistema.
\begin{description}
	\item[Identificatore]: come emerge dai requisiti, il dispositivo dovrà essere a basso consumo, in quanto la sua durata media non potrà essere inferiore a 3 anni. Questo vincolo, in combinazione con il budget limitato (5 euro per unità) e le dimensioni ridotte, crea la necessità di una ricerca sul mercato, in modo da verificare l'esistenza di dispositivi compatibili.
	
	Il dispositivo dovrà essere in grado di comunicare in modalità wireless con il lettore. Siccome il lettore, da requisiti, sarà un device Android (con un costo inferiore ai 200 euro per unità), le tecnologie di comunicazione utilizzabili si riducono a quelle supportate da tale device. Risulta quindi necessaria un'analisi di queste tecnologie, in modo da poter individuare il dispositivo più appropriato compatibile con almeno una di esse. 
	
	\item[Trasmissione dell'identificativo]: i requisiti stabiliscono la presenza di una fase di ricerca, attraverso la quale il lettore è in grado di scoprire gli identificatori all'interno di un raggio limitato (inferiore a 3 metri). Fra le tecnologie supportate da Android è necessario individuare solamente quelle che permettono di osservare questo vincolo. Inoltre, la tecnologia in oggetto deve poter permettere di stimare in maniera precisa la distanza del lettore dagli identificatori, in modo da stabilire con quale di questi effettuare l'interazione.
	
	Durante l'utilizzo concreto del sistema, vi è la possibilità che l'identificatore stimato come più vicino al lettore, possa non essere quello appartenente al paziente che necessita di soccorso. Immaginiamo, ad esempio, una situazione nella quale il paziente si trovi circondato da altre persone, anch'esse in possesso di un proprio identificatore. In questo caso, l'identificatore rilevato dal lettore del soccorritore, giunto sul posto, potrebbe non essere quello desiderato. Inoltre, è lecito pensare che il soccorritore stesso sia munito di un proprio identificatore, che quindi potrebbe essere confuso con quello del paziente. Una situazione come quella appena descritta è in contrasto con i requisiti, in quanto il soccorritore non è tenuto a consultare i dati medici relativi a persone che non sono coinvolte in una situazione di emergenza. 
	
	\item[Banca dati]: la banca dati è un archivio elettronico già esistente gestito da entità terze, che hanno il compito di mantenerla aggiornata. Non è quindi possibile assumere che un certo dato, precedentemente reperito dalla banca dati, sia consistente rispetto alla versione attuale. 
	
	La banca dati non fornisce alcun meccanismo per regolare l'accesso ai dati. Sarà quindi necessaria l'introduzione di un componente aggiuntivo, avente lo scopo di permettere l'accesso ai dati solamente ai soccorritori autorizzati.
	
	\item[Sicurezza]: il sistema è esposto a vari problemi riguardanti la sicurezza informatica, alcuni dichiarati esplicitamente dal committente e altri derivanti dall'analisi. 
	\begin{itemize}
		\item \emph{Tracciabilità}: dato che nei requisiti non è stato posto alcun vincolo riguardante la lettura dell'identificativo dei pazienti, ogni soggetto, tramite l'utilizzo di un lettore, è in grado di recuperare e memorizzare l'identificativo di ogni persona in possesso di un identificatore. Se l'identificativo contiene dei dati che possano permettere un'identificazione diretta del soggetto (ad esempio nome e cognome, codice fiscale, \dots), significa che un malintenzionato può risalire all'identità di tutte le persona nelle sue immediate vicinanze. Nel caso il malintenzionato sia anche un soccorritore autorizzato, egli potrebbe garantirsi un accesso continuo ai dati medici anche al di fuori delle situazioni di emergenza.
		\item \emph{Masquerade}: un malintenzionato potrebbe acquisire l'identificativo di un soggetto e utilizzarlo come proprio. In questo modo egli potrebbe, a tutti gli effetti, spacciarsi per un'altra persona. Nello specifico dominio medico, tale comportamento non permette di conseguire dei vantaggi evidenti, ma in un ambito più ampio e generale il malintenzionato potrebbe, così facendo, ottenere dei benefici non indifferenti. 
		\item \emph{Sniffing}: un malintenzionato potrebbe intercettare il flusso di informazioni scambiato tra il lettore di un soccorritore autorizzato e la banca dati. Così facendo, egli avrebbe un accesso diretto a tutti i dati medici di ogni paziente soccorso dal soccorritore.
		\item \emph{Replay attack}: un malintenzionato potrebbe intercettare la richiesta di dati medici di un paziente inviata dal lettore verso la banca dati. Tale richiesta potrebbe poi essere nuovamente inviata alla banca dati, ma questa volta da parte del malintenzionato, che così facendo potrebbe recuperare i dati medici del paziente.
		\item \emph{Identificativo compromesso}: nel caso l'identificatore di un soggetto venga perso/rubato/compromesso, egli non potrà usufruire del servizio, in quanto non sarebbe possibile una sua identificazione da parte di un soccorritore. Inoltre, chiunque venisse in possesso dell'identificatore in questione, potrebbe in ogni momento spacciarsi per il legittimo proprietario.
		\item \emph{Insider threats}: problema di distinguere accessi leciti e non alla banca dati. Ad esempio, un soccorritore autorizzato può potenzialmente accedere ai dati di ogni paziente (dato il relativo identificativo), ma tale accesso risulterebbe illecito nel caso venisse svolto al di fuori di una situazione di emergenza.
		\item \emph{Privacy}: i dati medici di un paziente acquisiti da un soccorritore autorizzato potrebbero, in un secondo momento, essere ri-consultati o divulgati dal soccorritore stesso, violando così la privacy del paziente.
	\end{itemize} 
\end{description}
Le problematiche fin qui illustrate si limitano allo specifico ambito medico. Come anticipato in sezione \ref{goal}, il caso medico è solamente un sottoinsieme del sistema generale, la cui idea è illustrata in sezione \ref{vision}. 

\section{Studio di fattibilità}


\begin{description}
	\item[Banca Dati]: come discusso in sezione \ref{issues}, i dati presenti all'interno della banca dati fornita sono gestiti da entità terze, che hanno la responsabilità di mantenerli aggiornati e quindi modificarli nel tempo. Questo rende problematica la memorizzazione dei dati stessi sul lettore del soccorritore, che potrebbe essere utile per questioni di performance. Infatti, qualora alcuni dati venissero memorizzati localmente, quelli all'interno della banca potrebbero venire aggiornati in seguito, creando così inconsistenza tra le due copie. Nella pratica, è possibile affrontare questa problematica in due modi:
	\begin{enumerate}
		\item Si potrebbe fare in modo di notificare, tramite Internet, i lettori di tutti i soccorritori ogniqualvolta un certo dato nella banca dati viene modificato. Alla ricezione di una notifica, il lettore aggiornerà, se necessario, i dati salvati in precedenza, evitando così la creazione di inconsistenze. Tuttavia, questo approccio presenta vari difetti: occorrerebbe definire una politica da attuare nel caso i lettori non fossero contattabili al momento dell'invio delle notifiche; inoltre, molto probabilmente non tutti i lettori saranno interessati alla totalità delle notifiche inviate, rendendo non necessario la maggior parte del traffico di rete generato. Per risolvere questo problema si potrebbe fare in modo di inviare notifiche relative ad un certo dato solo ai lettori interessati. Questo approccio introdurrebbe la necessità da parte dei lettori stessi di poter specificare i dati dei quali si desidera ricevere notifiche a riguardo, aggiungendo complessità alla soluzione.
		\item Non viene effettuata alcuna memorizzazione locale dei dati sul lettore. Ogni volta che un soccorritore necessiterà delle informazioni relative ad un certo paziente dovrà recuperarle sul momento dalla banca dati. Seguendo questo approccio viene resa impossibile la creazione di inconsistenze, al costo di una riduzione delle performance e di un maggior numero di richieste verso la banca dati.
	\end{enumerate} 
	
	Oltre a questa problematica, la banca dati non fornisce alcun meccanismo di autenticazione per poter regolare l'accesso ai dati in essa contenuti. Questo significa che, per soddisfare i requisiti di sicurezza, sarà necessario implementare tale meccanismo, impedendo così la lettura dei dati da parte di soggetti non autorizzati. Nella pratica, l'unico modo di fornire una politica di accesso basata sull'identità dei soccorritori e sui loro turni è attraverso la presenza di un componente dedicato, contattabile via Internet dai lettori dei soccorritori stessi. La banca dati dovrà, di conseguenza, poter essere interrogata solo da tale componente, in modo che vi sia un controllo totale sulle richieste verso la stessa. 
	
	L'accesso alla banca dati da parte del nuovo componente potrebbe essere:
	\begin{enumerate}
		\item Diretto: le due entità risiedono in uno stesso nodo computazionale o in una stessa rete privata. Così facendo, si potrebbe decidere di esporre sulla rete Internet solo il nuovo componente, garantendo quindi un maggior livello di sicurezza per la banca dati.
		\item Indiretto: l'accesso avviene tramite la rete Internet. In questo caso, la banca dati deve essere configurata in modo da accettare le sole richieste provenienti dal nuovo componente. 
	\end{enumerate}
	\item[Sicurezza] : ogni problematica relativa alla sicurezza accennata in sezione \ref{issues} necessita di un'analisi dettagliata, atta a stabilire se e come la problematica stessa sia risolvibile nella pratica rispettando i requisiti.
	\begin{itemize}
		\item \emph{Tracciabilità}: per fare in modo di evitare che un malintenzionato in possesso di un lettore possa ricostruire l'identità di un certo utente attraverso la sola lettura del suo identificativo, si potrebbe ricorrere all'uso di crittografia. Nel caso identificatore e banca dati condividessero una chiave segreta, allora il primo potrebbe criptare l'identificativo in modo che solo la banca dati possa effettivamente leggerlo. Questo approccio, tuttavia, presenta due problematiche. La prima consiste in una limitazione della scelta dell'identificatore ai soli in grado di eseguire operazioni di crittografia e la seconda consiste in un'aggiunta di overhead nelle interazioni tra i componenti del sistema. In alternativa, si potrebbe decidere di strutturare gli identificativi come sequenze casuali di caratteri, in modo che non sia necessaria alcuna operazione di crittografia e che un eventuale malintenzionato non riesca a risalire all'identità di una persona con il solo identificativo. Questo approccio inoltre non vincolerebbe la scelta dell'identificatore, che potrebbe essere un semplice tag NFC.
	\item \emph{Masquerade}: per evitare che un malintenzionato, venuto in possesso di un identificativo altrui, lo usi spacciandosi per il legittimo possessore si potrebbe ricorrere all'uso di identificativi \emph{one-shot}. L'idea è che identificatore e banca dati condividano un sequenza ordinata di identificativi e che siano concordi su di un identificativo di partenza. Ad ogni richiesta, l'identificatore fornirà un identificativo diverso, seguendo progressivamente l'ordine della sequenza. La banca dati seguirà lo stesso ordine e, a fronte di una richiesta da parte di un lettore, confronterà l'identificativo ottenuto con quello aspettato per capire se la richiesta sia valida o meno. Questo approccio risolve la problematica in questione, ma introduce un ulteriore problema, ovvero quello di mantenere sincronizzate le sequenze di lettore e banca dati. Nel caso venisse a crearsi una discrepanza tra le due, allora non sarebbe più possibile recuperare i dati relativi alla persona in possesso dell'identificatore.
	
	In ambito medico questa problematica non dovrebbe avere riscontri pratici, in quanto non si avrebbero vantaggi nel fornire dati medici altrui al posto dei propri. In altri ambiti, come ad esempio in quello commerciale, quanto appena detto non sussiste. In un'ottica più generale, qualora un utente fosse abilitato ad effettuare transazioni economiche tramite il servizio, un attacco di tipo \emph{masquerade} diverrebbe molto più sensato ed appetibile. Questo problema si potrebbe risolvere facendo sì che per determinate azioni effettuabili tramite il servizio vi debba obbligatoriamente essere un consenso esplicito da parte dell'utente. Tale consenso potrebbe essere espresso, ad esempio, tramite un app sul proprio smartphone. 
	\item \emph{Sniffing} \& \emph{Replay Attack}: nel caso la comunicazione via Internet tra lettore e banca dati avvenisse in chiaro, nulla impedirebbe ad un eventuale malintenzionato di intercettare il traffico di rete generato dagli stessi. In questo modo esso sarebbe in grado di leggere il contenuto informativo di tutte le risposte inviate dalla banca dati verso il lettore. Inoltre, il malintenzionato potrebbe intercettare una certa richiesta creata dal lettore e inoltrarla in seguito alla banca dati per ricevere tutte le informazioni mediche relative ad un determinato paziente. Nella pratica, per risolvere questi problemi è necessario ricorrere all'uso di crittografia. Nel nostro caso si potrebbe quindi utilizzare HTTPs al posto di HTTP, in modo che la totalità del traffico di rete scambiato tra lettore del soccorritore e banca dati sia indecifrabile da parte di malintenzionati. L'utilizzo di HTTPs, tuttavia, richiede che la banca dati sia in possesso di un certificato autentico.
	\item \emph{Identificativo compromesso}: non esistono soluzioni complete per fare fronte, in maniera automatizzata, a smarrimenti o furti di identificativi. Quel che si può fare è dare agli utenti del servizio la possibilità di denunciare tali avvenimenti, in modo che l'identificativo di interesse possa venire disabilitato. In tal caso, all'utente verrà consegnato un nuovo identificativo e la banca dati verrà aggiornata di conseguenza.
	\item \emph{Insider threats}: il problema degli accessi illeciti ai dati parte di soccorritori autorizzati risulta essere tra i più delicati. Anche in questo caso, purtroppo non esiste una soluzione totalmente automatizzata che permetta di eliminare
	completamente il problema. Tuttavia, per far fronte ad esso potrebbe venire memorizzato, nella banca dati, un file di \emph{log} contenente tutti gli accessi ai dati da parte di tutti i soccorritori, ognuno corredato da un \emph{timestamp}. Questo file potrebbe poi essere consultato per effettuare controlli sugli accessi stessi, verificando  che ognuno di questi abbia effettivamente avuto luogo in una situazione di emergenza.
	\item \emph{Privacy}: è immediato pensare che un soccorritore, una volta entrato in possesso dei dati sensibili di un paziente in seguito ad una situazione di emergenza, possa poi riutilizzarli per determinati fine e/o divulgarli. Questo risulterebbe in una violazione della privacy del paziente. Purtroppo non vi è modo di impedire che ciò accada; il soccorritore potrebbe, ad esempio, segnarsi i dati dopo averli visualizzati. Quel che si può fare è limitarsi a non memorizzare alcun dato sensibile all'interno del lettore e stabilire i provvedimenti da prendere nel caso si scopra che un certo soccorritore abbia violato la privacy di uno o più pazienti.
	\end{itemize}
\end{description}

\section{Abstraction gap}

\section{Analisi dei rischi}

\section{Architettura logica}
Il sistema risulta essere composto dalle seguenti componenti:
\begin{itemize}
	\item Server
	\item Lettore
	\item Identificatore
\end{itemize}

\subsection{Scenario I}
In una situazione di emergenza, il soccorritore arriva sul posto, apre l'applicazione sul proprio lettore e lo avvicina al proprio identificatore, in modo da autenticarsi nel sistema. Subito dopo il soccorritore avvicina il lettore all'identificatore del paziente e riceverà i dati medici dello stesso. 
\subsection{Scenario II}
In una situazione di emergenza, il soccorritore arriva sul posto, apre l'applicazione sul proprio lettore e lo avvicina al proprio identificatore, in modo da autenticarsi nel sistema. Subito dopo il soccorritore avvicina il lettore all'identificatore del paziente per richiedere i dati medici dello stesso. Nel caso essi non siano presenti nel sistema, dovrà essere mostrato un messaggio di errore.
\subsection{Scenario III} 
In una situazione di emergenza, il soccorritore arriva sul posto e apre l'applicazione sul proprio lettore. Nel caso non sia possibile creare alcuna connessione con il server, deve essere mostrato un messaggio che avvisa il soccorritore di intervenire ``manualmente'', senza contare sul servizio.



\chapter{Piano di lavoro}

\chapter{Progettazione}

\chapter{Implementazione}

\chapter{Testing} 

\chapter{Deployment (?)}

\chapter{Manutenzione}

\chapter{Restrospettiva}
\section{Giudizio finale}
\section{Sviluppi futuri}

 
\end{document}
